<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace配置了要映射的dao -->
<mapper namespace="com.formssi.dao.FileDao">

	<sql id="inc_whereClause" >
        <where>
            <if test="fileId!=null and fileId!=''">
                and file_id = #{fileId}
            </if>
            <if test="department!=null and department!=''">
                and upload_dep = #{department}
            </if>
            <if test="allowRank!=null and allowRank!=''">
                <![CDATA[and allow_rank >= ${allowRank}]]>
            </if>
            <if test="allowDep!=null and allowDep!=''">
                and FIND_IN_SET(${allowDep},allow_dep)
            </if>
        </where>
    </sql>
    
	<!-- 目的：为dao接口方法提供sql语句配置 -->
	<select id="queryById" resultType="com.formssi.entity.ShareFile" parameterType="String">
		SELECT
			file_id as fileId,
			allow_rank as allowRank,
			allow_dep as allowDep,
			file_desc as description,
			upload_dep as department,
			upload_user_id as userId,
			upload_time as uploadTime
		FROM
			share_file
		WHERE
			file_id = #{fileId}
	</select>
	
	<select id="queryAll" resultType="com.formssi.entity.ShareFile">
		SELECT
			file_id as fileId,
			allow_rank as allowRank,
			allow_dep as allowDep,
			file_desc as description,
			upload_dep as department,
			upload_user_id as userId,
			upload_time as uploadTime
		FROM
			share_file
		<include refid="inc_whereClause"/>
	</select>
	
	<insert id="add" parameterType="com.formssi.entity.ShareFile">
		insert into share_file(file_id, allow_rank, allow_dep, file_desc, upload_dep, upload_user_id) 
		values(#{fileId}, #{allowRank}, #{allowDep}, #{description}, #{department}, #{userId})
	</insert>
	
</mapper>