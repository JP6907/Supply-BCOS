<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace配置了要映射的dao -->
<mapper namespace="com.formssi.dao.UserDao">
	<!-- 目的：为dao接口方法提供sql语句配置 -->
	
	<sql id="inc_whereClause" >
        <where>
            <if test="rank!=null and rank!=''">
                and rank = #{rank}
            </if>
            <if test="department!=null and department!=''">
                and department = #{department}
            </if>
            <if test="userId!=null and userId!=''">
                and id = #{userId}
            </if>
            <if test="userName!=null and userName!=''">
                and name = #{userName}
            </if>
        </where>
    </sql>
	
	<select id="queryById" resultType="com.formssi.entity.User" parameterType="String">
		SELECT
			id as userId,
			name as userName,
			pw as password,
			rank as rank,
			department as department
		FROM
			army_user
		WHERE
			id = #{id}
	</select>
	
	<insert id="add" parameterType="com.formssi.entity.User">
		insert into army_user(id, name, pw, rank, department, type) 
		values(#{userId}, #{userName}, #{password}, #{rank}, #{department}, 0)
	</insert>
	
	<select id="queryUser" resultType="com.formssi.entity.User">
		SELECT
			id as userId,
			name as userName,
			rank as rank,
			department as department
		FROM
			army_user
		<include refid="inc_whereClause"/>
		order by update_time desc
	</select>
	
	
	<update id="updateUser" parameterType="com.formssi.entity.User">
		UPDATE army_user 
			<set>
				<if test="userName != null">
					name = #{userName, jdbcType=VARCHAR},
				</if>
				<if test="password != null">
					pw = #{password, jdbcType=VARCHAR},
				</if>
				<if test="rank != 0">
					rank = #{rank, jdbcType=INTEGER},
				</if>
				<if test="department != 0">
					department = #{department, jdbcType=INTEGER},
				</if>
				update_time = CURRENT_TIMESTAMP
			</set> 
			
		where id = #{userId, jdbcType=VARCHAR}
	</update>
	
	
</mapper>